<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<title>WebPhotos</title>
<style>
body {
    font-family: Arial;
    background: #111;
    color: #eee;
    padding: 30px;
}
input, button {
    padding: 10px;
    margin: 5px 0;
    width: 100%;
}
button {
    background: #3fa9f5;
    border: none;
    cursor: pointer;
}
#logs {
    margin-top: 20px;
    background: #000;
    padding: 15px;
    height: 300px;
    overflow-y: auto;
    white-space: pre-line;
}
.hidden {
    display: none;
}
</style>
</head>
<body>

<h2>WebPhotos</h2>

<input id="url" placeholder="Adres strony">
<input id="folder" placeholder="Nazwa folderu">
<button onclick="start()">START</button>

<button id="download" class="hidden">Pobierz ZIP</button>

<div id="logs"></div>

<script>
let jobId = null;
let timer = null;

function start() {
    document.getElementById("logs").textContent = "";
    document.getElementById("download").classList.add("hidden");

    fetch("/start", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            url: document.getElementById("url").value,
            folder: document.getElementById("folder").value
        })
    })
    .then(r => r.json())
    .then(d => {
        jobId = d.job_id;
        timer = setInterval(checkStatus, 1500);
    });
}

function checkStatus() {
    fetch("/status/" + jobId)
    .then(r => r.json())
    .then(d => {
        document.getElementById("logs").textContent =
            d.logs.join("\n");

        if (d.done) {
            clearInterval(timer);
            document.getElementById("download").classList.remove("hidden");
            document.getElementById("download").onclick = () => {
                window.location = "/download/" + jobId;
            };
        }
    });
}
</script>

</body>
</html>
