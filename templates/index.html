<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>WebPages</title>

<style>
body {
    margin: 0;
    font-family: Arial;
    background: #f5f5f5;
}

.overlay {
    max-width: 600px;
    margin: 40px auto;
    background: white;
    padding: 20px;
    border-radius: 10px;
}

h1 {
    text-align: center;
    color: black;
}

input, button {
    width: 100%;
    padding: 10px;
    margin-top: 10px;
}

.progress {
    width: 100%;
    height: 18px;
    background: #ddd;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 15px;
}

.progress-bar {
    height: 100%;
    width: 0%;
    background: #4caf50;
    transition: width .3s;
}

.log {
    margin-top: 15px;
    font-family: monospace;
}

.errors {
    margin-top: 8px;
    max-height: 120px;
    overflow-y: auto;
    font-family: monospace;
    font-size: 13px;
    color: #d32f2f;
    border-top: 1px solid #ddd;
    padding-top: 5px;
}
</style>
</head>

<body>
<div class="overlay">
<h1>WebPages</h1>

<input id="url" placeholder="URL strony">
<input id="folder" placeholder="Nazwa folderu">

<button onclick="start()">START</button>
<button id="zipBtn" style="display:none" onclick="download()">Pobierz ZIP</button>

<div class="progress">
  <div class="progress-bar" id="bar"></div>
</div>

<div class="log" id="log"></div>
<div class="errors" id="errors"></div>
</div>

<script>
let job = null
let dots = 0

function start(){
  fetch("/start", {
    method:"POST",
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({
      url: url.value,
      folder: folder.value
    })
  }).then(r=>r.json()).then(d=>{
    job = d.job_id
    poll()
  })
}

function poll(){
  fetch("/status/"+job).then(r=>r.json()).then(d=>{
    bar.style.width = d.progress+"%"

    if(!d.done && !d.error){
      dots = (dots+1)%4
      log.innerText = d.log + ".".repeat(dots)

      if (d.errors && d.errors.length > 0) {
  errors.innerHTML = d.errors
    .slice(-10)
    .map(e => `<div>${e}</div>`)
    .join("")
} else {
  errors.innerHTML = ""
}


      setTimeout(poll, 800)
    }

    if(d.done){
      log.innerText = d.log
      zipBtn.style.display="block"
    }

    if(d.error){
      log.innerText = "BŁĄD!"
    }
  })
}

function download(){
  window.location="/download/"+job
}
</script>

</body>
</html>

