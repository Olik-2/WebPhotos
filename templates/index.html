<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>WebPhotos</title>
</head>
<body>

<h2>WebPhotos</h2>

<input id="url" placeholder="URL strony"><br><br>
<input id="folder" placeholder="Nazwa folderu"><br><br>

<button onclick="start()">START</button>

<pre id="log"></pre>

<script>
let jobId = null;

function log(msg) {
  document.getElementById("log").textContent += msg + "\n";
}

async function start() {
  log("➡ Startuję job...");

  const res = await fetch("/start", {
    method: "POST",
    headers: {"Content-Type": "application/json"},
    body: JSON.stringify({
      url: document.getElementById("url").value,
      folder: document.getElementById("folder").value
    })
  });

  const data = await res.json();
  jobId = data.job_id;
  log("✔ Job ID: " + jobId);

  poll();
}

async function poll() {
  const r = await fetch("/status/" + jobId);
  const data = await r.json();

  document.getElementById("log").textContent = data.logs.join("\n");

  if (!data.done) {
    setTimeout(poll, 1500);
  } else {
    log("\n✅ GOTOWE");
    log("⬇ Pobierz ZIP:");
    log(location.origin + "/download/" + jobId);
  }
}
</script>

</body>
</html>
